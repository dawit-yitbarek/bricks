import React, { useState } from "react";
import api from "./Api";

function TelegramLogin(){
    const [isScriptLoaded, setIsScriptLoaded] = useState(false)

    function handleLogin(){
        if (!isScriptLoaded) {
            console.log('telegram started')
            const script = document.createElement("script");
            script.src = "https://telegram.org/js/telegram-widget.js?7";
            script.async = true;
            script.onload = () => {
                console.log('telegram loaded')
                window.TelegramLoginWidget = async (user) => {
                    console.log("telegram widget");
                    const response = await api.post("http://localhost:3000/auth/telegram", user)
                    console.log(response.data)
                }
            }
            document.body.appendChild(script);
            setIsScriptLoaded(true)
        }
    }



    return(
        <button onClick={handleLogin}>Login With Telegram</button>
    )
}

export default TelegramLogin;